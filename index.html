<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>VÃ­kend AI â€“ Chat</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>

/* ================= GOLD BACKGROUND ================= */

body {
  margin: 0;
  background: linear-gradient(
    130deg,
    #2b211c,
    #3a2c25,
    #1f1713,
    #3a2c25
  );
  background-size: 300% 300%;
  animation: gradientMove 20s ease infinite;
  overflow-x: hidden;
}

@keyframes gradientMove {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* ================= GOLD GLASS ================= */

.glass {
  position: relative;
  background: rgba(255,215,150,0.05);
  border: 1px solid rgba(212,175,55,0.25);
  border-radius: 26px;
  box-shadow:
    0 30px 80px rgba(0,0,0,0.6),
    inset 0 1px 0 rgba(255,215,150,0.4),
    0 0 60px rgba(212,175,55,0.15);
  overflow: hidden;
}

/* ================= TIMELINE ================= */

.timeline-wrapper {
  display: flex;
  overflow-x: auto;
  scroll-snap-type: x proximity;
  padding: 8px 24px;
  gap: 12px;
}

.timeline-wrapper::-webkit-scrollbar { display:none; }

.timeline-bubble {
  scroll-snap-align: center;
  padding: 12px 18px;
  border-radius: 24px;
  min-width: 200px;
  max-width: 260px;

  background: rgba(255,215,150,0.05);
  border: 1px solid rgba(212,175,55,0.25);

  box-shadow:
    0 20px 60px rgba(0,0,0,0.6),
    inset 0 1px 0 rgba(255,215,150,0.4);

  transition: transform 0.25s ease, opacity 0.25s ease;
  opacity: 0.4;

  /* ðŸ‘‡ NOVÃ‰ */
  font-size: 14px;
  line-height: 1.3em;
  max-height: calc(1.3em * 3);
  overflow: hidden;
}


.timeline-bubble.active {
  box-shadow:
    0 0 120px rgba(212,175,55,0.6),
    0 30px 80px rgba(0,0,0,0.7);
}

/* ================= CHAT ================= */

#chat {
  flex: 1;
  overflow-y: auto;
}

#chat::-webkit-scrollbar { width:4px; }
#chat::-webkit-scrollbar-thumb {
  background: rgba(212,175,55,0.4);
  border-radius: 10px;
}

/* ================= FLOATING INPUT ================= */

.input-wrapper {
  position: fixed;
  bottom: 16px;
  left: 50%;
  transform: translateX(-50%);
  width: 94%;
  max-width: 520px;
  display: flex;
  align-items: center;
  gap: 8px;
  background: rgba(30,22,18,0.95);
  border: 1px solid rgba(212,175,55,0.3);
  border-radius: 40px;
  padding: 6px 8px;
  box-shadow: 0 15px 40px rgba(0,0,0,0.6);
}

/* ================= THINKING DOTS ================= */

.dots::after {
  content: "";
  animation: dots 1.4s infinite;
}

@keyframes dots {
  0% { content: ""; }
  25% { content: "."; }
  50% { content: ".."; }
  75% { content: "..."; }
}

</style>
</head>

<body class="flex flex-col h-screen text-amber-100 overflow-hidden">

<!-- HEADER -->
<header class="flex items-center justify-center pt-3 pb-2">
  <div class="text-2xl tracking-widest text-yellow-600 font-semibold">
    ELIS
  </div>
</header>

<!-- PLAYER -->
<div class="flex justify-center pb-2">
  <input id="player"
         value="adam"
         class="bg-[#1f1713] border border-yellow-700/40
                text-amber-200 px-3 py-1 rounded-lg text-sm
                focus:outline-none" />
</div>

<!-- NÃSTÄšNKA -->
<div id="wallSection" class="timeline-wrapper"></div>

<!-- CHAT -->
<div id="chat" class="px-6 pt-4 space-y-6 max-w-2xl mx-auto"
     style="padding-bottom: 140px;"></div>

<!-- INPUT -->
<div class="input-wrapper">
  <input id="input"
         type="text"
         placeholder="NapiÅ¡ zprÃ¡vu Elisâ€¦"
         class="flex-1 bg-transparent text-amber-100 px-6 py-2 text-sm focus:outline-none" />
  <button onclick="send()"
          class="w-10 h-10 flex items-center justify-center rounded-full
                 bg-gradient-to-br from-yellow-600 to-amber-400
                 text-[#2b211c] shadow-md hover:scale-105 transition">
    âž¤
  </button>
</div>

<script>

/* ================= PÅ®VODNÃ LOGIKA ================= */

const API_URL = "https://aivikend-py-f8ava9bjejh3h6bf.westeurope-01.azurewebsites.net/api/http_trigger";

const chat = document.getElementById("chat");
const input = document.getElementById("input");
const playerInput = document.getElementById("player");
const wallContent = document.getElementById("wallSection");

/* ================= VEÅ˜EJNÃ NÃSTÄšNKA ================= */

async function loadPublicWall() {
  try {
    const res = await fetch(API_URL + "?mode=public_log");
    const data = await res.json();

    wallContent.innerHTML = "";

    if (!data.items || !data.items.length) {
      const empty = document.createElement("div");
      empty.className = "timeline-bubble";
      empty.innerText = "â€” zatÃ­m Å¾Ã¡dnÃ© zÃ¡znamy â€”";
      wallContent.appendChild(empty);
      return;
    }

    const last = data.items.slice(-12);

    last.forEach((text, index) => {
      const div = document.createElement("div");
      div.className = "timeline-bubble";
      div.textContent = text;
      wallContent.appendChild(div);

      if (index === last.length - 1) {
        div.classList.add("active");
        setTimeout(() => {
          div.scrollIntoView({ inline: "center" });
        }, 0);
      }
    });

    updateTimelineScale(wallContent);

  } catch {
    const error = document.createElement("div");
    error.className = "timeline-bubble";
    error.innerText = "âš ï¸ Nelze naÄÃ­st nÃ¡stÄ›nku";
    wallContent.appendChild(error);
  }
}

function updateTimelineScale(container) {
  const bubbles = container.querySelectorAll(".timeline-bubble");
  const center = container.scrollLeft + container.offsetWidth / 2;

  bubbles.forEach(bubble => {
    const bubbleCenter =
      bubble.offsetLeft + bubble.offsetWidth / 2;

    const distance = Math.abs(center - bubbleCenter);
    const maxDistance = container.offsetWidth / 2;
    const ratio = Math.max(0, 1 - distance / maxDistance);

    const scale = 0.7 + ratio * 0.5;
    const opacity = 0.2 + ratio * 0.8;

    bubble.style.transform = `scale(${scale})`;
    bubble.style.opacity = opacity;
  });
}

wallContent.addEventListener("scroll", function() {
  updateTimelineScale(this);
});

/* ================= THINKING ================= */

const thinkingStates = [
  "OmlouvÃ¡m se za zpoÅ¾dÄ›nÃ­. Elis se chvÄ›jÃ­ Äipy vzruÅ¡enÃ­m",
  "UÅ¾ to bude. Elis se blÃ­Å¾Ã­ k vrcholu",
  "Elis po orgasmus sklÃ¡dÃ¡ odpovÄ›Ä trochu dÃ©le neÅ¾ obvykle",
  "Elis mÃ¡ moc zÃ¡Å¾itkÅ¯ a je pomalejÅ¡Ã­",
  "Elis se pÅ™ipravuje na dalÅ¡Ã­ divokou akci"
];

const silentResponses = [
  "Elis si to zapamatuje.",
  "Elis mlÄky pÅ™ikÃ½vne.",
  "Elis vÃ­.",
  "Elis to nechÃ¡ bez komentÃ¡Å™e.",
  "Elis to zaznamenala."
];

let thinkingEl = null;
let thinkingInterval = null;
let stateIndex = 0;

function showThinking() {
  thinkingEl = document.createElement("div");
  thinkingEl.className = "flex justify-start";

  const inner = document.createElement("div");
  inner.className = "glass px-5 py-3 rounded-3xl italic";

  thinkingEl.appendChild(inner);
  chat.appendChild(thinkingEl);

  updateThinkingText(inner);

  thinkingInterval = setInterval(() => {
    stateIndex = (stateIndex + 1) % thinkingStates.length;
    updateThinkingText(inner);
  }, 3000);

  chat.scrollTop = chat.scrollHeight;
}

function updateThinkingText(element) {
  element.innerHTML =
    `<strong>Elis</strong> ${thinkingStates[stateIndex]}<span class="dots"></span>`;
}

function hideThinking() {
  if (thinkingInterval) clearInterval(thinkingInterval);
  if (thinkingEl) thinkingEl.remove();
  thinkingEl = null;
  thinkingInterval = null;
  stateIndex = 0;
}

/* ================= CHAT ================= */

input.addEventListener("keydown", e => {
  if (e.key === "Enter") send();
});

async function send() {
  const text = input.value.trim();
  if (!text) return;

  const player = playerInput.value.trim() || "adam";

  add(player, text, "user");
  input.value = "";
  showThinking();

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: text, player })
    });

    const data = await res.json();
    hideThinking();

    if (data.text && data.text.trim().length > 0) {
      add("Elis", data.text, "ai");
    } else if (
      data.debug &&
      (
        (data.debug.private && data.debug.private.lines?.length) ||
        (data.debug.public && data.debug.public.length)
      )
    ) {
      const reaction =
        silentResponses[Math.floor(Math.random() * silentResponses.length)];
      add("Elis", reaction, "ai");
    }

    loadPublicWall();

  } catch {
    hideThinking();
    add("Chyba", "Nelze se spojit se serverem.", "ai");
  }
}

function add(author, text, cls) {
  const div = document.createElement("div");
  div.className = cls === "user"
    ? "flex justify-end"
    : "flex justify-start";

  div.innerHTML = `
    <div class="max-w-[70%] px-5 py-3 rounded-3xl ${
      cls === "user"
        ? "bg-gradient-to-br from-yellow-600 to-amber-400 text-[#2b211c]"
        : "glass"
    }">
      <strong>${author}</strong>${escapeHtml(text)}
    </div>`;

  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function escapeHtml(str) {
  return str
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;");
}

/* ================= START ================= */

loadPublicWall();
setInterval(loadPublicWall, 15000);

</script>

</body>
</html>
